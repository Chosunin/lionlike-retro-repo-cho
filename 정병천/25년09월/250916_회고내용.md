## 250915 회고록


### 오늘 배운 내용 중 가장 기억에 남는 3가지

1. ResultSet 별도 묶음

```java
/** 전체조회 */
@Override
public List<ProductDTO> selectAll() {
    String sql = "SELECT * FROM products";
    List<ProductDTO> lists = new ArrayList<>();

    try (
            Connection conn = DBUtil.getConnection();
            PreparedStatement ps = conn.prepareStatement(sql);
            ResultSet rs = ps.executeQuery()
    ) {
        while (rs.next()) {
            lists.add(resultSet(rs));
        }
    } catch (Exception e) {
        System.out.println("전체선택 error : " + e.getMessage());
    }

    return lists;
}

/** 리절트 공통 */
private ProductDTO resultSet(ResultSet rs) throws SQLException {
    ProductDTO pDTO = new ProductDTO();
    pDTO.setId(rs.getInt("id"));
    pDTO.setName(rs.getString("name"));
    pDTO.setPrice(rs.getInt("price"));
    // pDTO.setRegdate(rs.getTimestamp("reg_date").toLocalDateTime());
    Timestamp regDate = rs.getTimestamp("reg_date");
    if(regDate != null) pDTO.setRegdate(regDate.toLocalDateTime());

    return pDTO;
}
```

DAO 메서드에서 ResultSet으로 테이블 컬럼 값을 매핑할 때, 다른 메서드에서도 반복되는 경우가 많았는데 <br>
이를 하나로 묶어 재사용하니 코드가 훨씬 깔끔하고 좋았다.



---

### 오늘 배운 내용 중 가장 어렵거나 헷갈렸던 것 3가지

1.  DAO 패턴에서 트랜잭션 처리 역할은 어디?

DAO는 데이터베이스 작업(SQL 실행)만 담당하고, 트랜잭션은 비즈니스로직 담당하는 클래스에서 처리해야 한다.

* DAO는 단일 쿼리 단위로 끝남
* 트랜잭션 범위는 여러 DAO 호출하는 곳에서 처리
* DAO 내에서 트랜잭션 열고 커밋할 경우 벨리데이션체크없이 확정되어 원하는 결과를 얻지 못함

즉 DAO는 쿼리 담당 / 트랜잭션은 DAO 호출하는 서비스 로직에서 처리

```java
public class TransferService {
    private final AccountDAO dao = new AccountDAO();

    public void transfer(int fromId, int toId, int money) {
        Connection conn = null;
        try {
            conn = DBUtil.getConnection();
            conn.setAutoCommit(false);   // 트랜잭션 시작

            dao.withdraw(conn, fromId, money); // 출금
            dao.deposit(conn, toId, money);    // 입금

            conn.commit();   // 둘 다 성공 → 커밋
        } catch (Exception e) {
            try {
                if (conn != null) conn.rollback();
            } catch (SQLException e) {
                System.out.println(e.getMessage());
            }
        } finally {
            try { 
                if (conn != null) conn.close(); 
            } catch (SQLException e) {
                System.out.println(e.getMessage());
            }
        }
    }
}
```

처음에는 깔끔하게 DAO에서 처리하면 되는거 아닌가 생각을 했는데 <br>
DAO는 단일 쿼리문만 실행해서 하는 것이지 성공여부 판단을 DAO가 가지면 안된다라는게 <br>
이해하기 어려웠었다. ai통해서 물어봐서 어느정도 이해는 되었다.


---
   
### 오늘 강의시간, 회고시간에 대한 느낀점 (부족했던 부분이나 재밌었던 부분 등)

HikariCP에 대해 개념적인 설명만 듣고 직접 코드를 작성해보지 못한 점이 아쉬웠다. <br>
스프링 부트에서 히카리 설정을 다룰 때 다시 배워보고 싶다.