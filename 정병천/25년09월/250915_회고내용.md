## 250915 회고록


### 오늘 배운 내용 중 가장 기억에 남는 3가지

1. Connection, PreparedStatement, ResultSet

* ` Connection` = 자바에서 DB와의 연결(세션)을 표현하는 객체
*  `PreparedStatement` = '?' 인자를 통해 바인딩 접근 방식
*  `executeUpdate()` = insert, update, delete, create, drop 실행 결과 int 반환 (성공 행 갯수)
*  `executeQuery()` = select 전용 ResultSet 객체 반환
* `ResultSet` = 자바에서 db의 테이블 행열 정보를 다루는 객체임
    - `rs.next()`로 행 단위 탐색
    - `rs.getString("컬럼명")` 으로 해당 컬럼의 데이터 얻음



---

### 오늘 배운 내용 중 가장 어렵거나 헷갈렸던 것 3가지

1. DTO DAO 만드는 과정

* DTO = DB의 테이블 한 행(row) 구조를 담는 객체 (그릇)

```java
public class DeptDTO {
    private int deptno;
    private String dname;
    private String loc;

    public int getDeptno() {
        return deptno;
    }

    public void setDeptno(int deptno) {
        this.deptno = deptno;
    }

    public String getDname() {
        return dname;
    }

    public void setDname(String dname) {
        this.dname = dname;
    }

    public String getLoc() {
        return loc;
    }

    public void setLoc(String loc) {
        this.loc = loc;
    }
}
```



* DAO = DB에 직접 접근해서 CRUD 실행하는 객체


```java
import week_06._0915.lionDB.DBUtil;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.util.ArrayList;
import java.util.List;

public class DeptDAO {
    
    /** 튜플 삭제 */
    public static boolean deleteDept(DeptDTO deptDTO){
        String sql = "delete from dept where deptno=?";
        int resultCount = 0;

        try(
            Connection conn = DBUtil.getConnection();
            PreparedStatement ps = conn.prepareStatement(sql)
        ) {
            ps.setInt(1, deptDTO.getDeptno());
            resultCount = ps.executeUpdate();
        } catch(Exception e) {
            System.out.println(e.getMessage());
        }

        return resultCount > 0;
    }

    /** 튜플 변경 */
    public static boolean updateDept(DeptDTO deptDTO){
        String sql = "update dept set dname=? where deptno=?";
        int resultCount = 0;

        try(
            Connection conn = DBUtil.getConnection();
            PreparedStatement ps = conn.prepareStatement(sql)
        ) {
            ps.setString(1, deptDTO.getDname());
            ps.setInt(2, deptDTO.getDeptno());
            resultCount = ps.executeUpdate();
        } catch(Exception e) {
            System.out.println(e.getMessage());
        }

        return resultCount > 0;
    }

    /** 튜플 추가 */
    public static boolean insertDept(DeptDTO deptDTO){
        String sql = "insert into dept(deptno, dname, loc) values (?,?,?)";
        int resultCount = 0;

        try(
            Connection conn = DBUtil.getConnection();
            PreparedStatement ps = conn.prepareStatement(sql)
        ) {
            ps.setInt(1, deptDTO.getDeptno());
            ps.setString(2, deptDTO.getDname());
            ps.setString(3, deptDTO.getLoc());
            resultCount = ps.executeUpdate();
        } catch(Exception e) {
            System.out.println(e.getMessage());
        }

        return resultCount > 0;
    }

    /** 단건 조회 */
    public static DeptDTO getDept(int deptno) {
        String sql = "select deptno, dname, loc from dept where deptno = ?";
        DeptDTO deptDTO = null;
        ResultSet rs = null;

        try(
            Connection conn = DBUtil.getConnection();
            PreparedStatement ps = conn.prepareStatement(sql)
        ) {
            // 스테이트먼트 셋 먼저 적용후 익스큐트쿼리 써야함.
            ps.setInt(1, deptno);
            rs = ps.executeQuery();
            if(rs.next()) {
                deptDTO = new DeptDTO();
                deptDTO.setDeptno(rs.getInt("deptno"));
                deptDTO.setDname(rs.getString("dname"));
                deptDTO.setLoc(rs.getString("loc"));
            }
        } catch(Exception e) {
            System.out.println(e.getMessage());
        } finally {
            DBUtil.close(rs);
        }

        return  deptDTO;
    }

    /** 전체 조회 */
    public static List<DeptDTO> getAll() {
        String sql = "select deptno, dname, loc from dept";
        List<DeptDTO> list = new ArrayList<>();
        
        try(
            Connection conn = DBUtil.getConnection();
            PreparedStatement ps = conn.prepareStatement(sql);
            ResultSet rs = ps.executeQuery()
        ) {

            while (rs.next()) {
                DeptDTO deptDTO = new DeptDTO();
                deptDTO.setDeptno(rs.getInt(1));
                deptDTO.setDname(rs.getString(2));
                deptDTO.setLoc(rs.getString(3));
                list.add(deptDTO);
            }

        } catch(Exception e) {
            System.out.println(e.getMessage());
        }

        return list;
    }
}
```


결과물을 보면 소스자체가 크게 어려운건 아닌데 강의 도중에 전체조회, 단건조회 만들려고 할때 막혀서 <br>
많이 애먹었었다. 진짜.. 노력 많이 해야겠다.



---
   
### 오늘 강의시간, 회고시간에 대한 느낀점 (부족했던 부분이나 재밌었던 부분 등)

지난주 금요일 오후에 조퇴하였는데 오늘 강의에서 강사님 화면에 그래들 빌드로 되어 있길래 당황스러웠다. <br>
그래서 일단 기존 메이븐 빌드 상태에서 수업따라가면서 중간에 그래들로 빌드 할려다가 꼬여서 <br>
자바가 실행되지 않는 문제가 발생해 이를 해결하느라 강의에 충분히 집중하지 못한 점이 아쉬웠다.

<br>

회고 시간에는 DAO·DTO 패턴을 적용해보는 실습을 진행했는데 <br>
DAO 테스트 과정에서 기존 DB 테이블의 프라이머리 키가 AUTO_INCREMENT로 설정되어 있어서 <br>
insert와 delete를 반복할 때마다 값이 누적되는 것을 보고 처음에는 “어라, 왜 그러지?” 하면서 당황했다. <br>
다행히 팀원분들이 원리를 설명해 주셔서 이해할 수 있었고, 지난 목요일 회고 시간에 공유되었던 관련 팁 스레드도 큰 도움이 되었다.